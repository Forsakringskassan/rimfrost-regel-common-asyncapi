asyncapi: 3.0.0
info:
  title: Regel - Common Async API
  version: 1.0.0
  description: Generiskt Async API för initiering av regler

channels:
  regel.requests:
    address: regel.requests
    messages:
      RegelRequestMessage:
        $ref: "#/components/messages/RegelRequestMessage"

  regel.responses:
    address: regel.responses
    messages:
      RegelResponseMessage:
        $ref: "#/components/messages/RegelResponseMessage"

operations:
  RegelRequest:
    action: receive
    summary: Initierar evaluering av regeln
    channel:
      $ref: "#/channels/regel.requests"
    reply:
      address:
        description: Resultatet skickas tillbaka till källan.
        location: "$message.header#/replyTo"
      channel:
        $ref: "#/channels/regel.responses"

components:
  schemas:
    RegelRequestMessageHeaders:
      type: object
      properties:
        replyTo:
          type: string
          description: Topic där response ska skickas
        correlationId:
          type: string
          format: uuid
          description: Unikt ID som kopplar ihop request & response

    RegelRequestMessageData:
      type: object
      title: RegelRequestMessageData
      required:
        - kundbehovsflodeId
      properties:
        kundbehovsflodeId:
          type: string
          format: uuid
          description: Kundbehovsflöde id

    RegelResponseMessageHeaders:
      type: object
      properties:
        correlationId:
          type: string
          format: uuid
          description: Unikt ID som kopplar ihop request & response

    RegelResponseMessageData:
      type: object
      title: RegelResponseMessageData
      required:
        - kundbehovsflodeId
        - rattTillForsakring
      properties:
        kundbehovsflodeId:
          type: string
          format: uuid
          description: Kundbehovsflöde id
        rattTillForsakring:
          title: rattTillForsakring
          type: string
          description: Utfall av regel, om personen har rätt till försäkring
          enum:
            - Ja
            - Nej

  messages:
    RegelRequestMessage:
      headers:
        $ref: "#/components/schemas/RegelRequestMessageHeaders"
      payload:
        title: RegelRequestMessagePayload
        allOf:
          - $ref: "kogito-cloudevent.yaml#/components/schemas/KogitoCloudEvent"
          - type: object
            title: RegelRequestMessageData
            required:
              - data
            properties:
              data:
                $ref: "#/components/schemas/RegelRequestMessageData"

    RegelResponseMessage:
      headers:
        $ref: "#/components/schemas/RegelResponseMessageHeaders"
      payload:
        title: RegelResponseMessagePayload
        allOf:
          - $ref: "kogito-cloudevent.yaml#/components/schemas/KogitoCloudEvent"
          - type: object
            title: RegelResponseMessageData
            required:
              - data
            properties:
              data:
                $ref: "#/components/schemas/RegelResponseMessageData"

